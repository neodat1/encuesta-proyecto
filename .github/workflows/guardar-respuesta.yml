name: Guardar respuesta

on:
  repository_dispatch:
    types: [nueva-respuesta]

jobs:
  actualizar-respuestas:
    runs-on: ubuntu-latest

    steps:
    - name: Clonar repositorio
      uses: actions/checkout@v3

    - name: Configurar Node.js
      uses: actions/setup-node@v3
      with:
        node-version: 16

    - name: Agregar nueva respuesta
      run: |
        echo "Agregando nueva respuesta..."

        FILE="responses.json"
        TEMP="temp.json"
        NOMBRE="${{ github.event.client_payload.datos.nombre }}"
        EDAD="${{ github.event.client_payload.datos.edad }}"
        FECHA="${{ github.event.client_payload.datos.fecha }}"

        jq --arg nombre "$NOMBRE" --arg edad "$EDAD" --arg fecha "$FECHA" \
          '. += [{"nombre": $nombre, "edad": $edad, "fecha": $fecha}]' "$FILE" > "$TEMP"
        mv "$TEMP" "$FILE"

    - name: Commit y push
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "Agregar nueva respuesta"
        branch: main
