name: Guardar respuestas de encuesta

on:
  push:
    paths:
      - responses-temp.json

jobs:
  actualizar-respuestas:
    runs-on: ubuntu-latest

    steps:
      - name: Clonar repositorio
        uses: actions/checkout@v3

      - name: Leer archivo temporal y combinar con respuestas.json
        run: |
          echo "ğŸ“¥ Cargando respuesta temporal..."
          cat responses-temp.json

          echo "ğŸ“ Asegurando existencia de responses.json"
          if [ ! -f responses.json ]; then
            echo "[]" > responses.json
          fi

          echo "ğŸ“¦ Fusionando datos..."
          jq -s '.[0] as $new | .[1] + [$new]' responses-temp.json responses.json > merged.json
          mv merged.json responses.json

          echo "ğŸ§¹ Eliminando temporal..."
          rm responses-temp.json

      - name: Subir cambios
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Nueva respuesta guardada automÃ¡ticamente"
