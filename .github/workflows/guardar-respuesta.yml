name: Guardar respuesta de encuesta

on:
  issues:
    types: [opened]

jobs:
  agregar-respuesta:
    runs-on: ubuntu-latest
    steps:
      - name: Clonar repo
        uses: actions/checkout@v4

      - name: Agregar respuesta a responses.json
        run: |
          echo "Agregando nueva respuesta..."
          # Extraer datos del issue
          RESPUESTA=$(jq -r .issue.body "$GITHUB_EVENT_PATH")
          # Leer archivo actual (o crear vacÃ­o)
          if [ -f responses.json ]; then
            jq ". += [$RESPUESTA]" responses.json > temp.json
          else
            echo "[]" > responses.json
            jq ". += [$RESPUESTA]" responses.json > temp.json
          fi
          mv temp.json responses.json

      - name: Hacer commit y push
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Agregar respuesta desde issue"
          branch: main

      - name: Cerrar issue
        uses: peter-evans/close-issue@v3
        with:
          issue-number: ${{ github.event.issue.number }}
